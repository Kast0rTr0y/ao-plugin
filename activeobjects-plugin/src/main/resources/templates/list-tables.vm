#* @vtlvariable name="tables" type="com.google.common.collect.Multimap<com.atlassian.activeobjects.spi.PluginInformation, com.atlassian.activeobjects.admin.tables.TablesController.TableInformation>" *#
<html>
    <head>
        <meta name="decorator" content="atl.admin">

        <meta name="admin.active.tab" content="ao_tables"/>
        <meta name="admin.active.section" content="admin_system_menu/advanced_menu_section/advanced_section"/>

        <title>$i18n.getText("ao.admin.title")</title>
        $webResourceManager.requireResource("com.atlassian.activeobjects.activeobjects-plugin:web-resources")
    </head>
    <body>
        <h1>$i18n.getText("ao.admin.tables.title")</h1>
        
        #if ($message)
            <div class="aui-message $message.type shadowed">
                <p>
                    <span class="aui-icon icon-$message.type"></span>
                    $message.title
                </p>
            </div><!-- .aui-message --> 
        #end

        <form action="drop" method="POST" >
            <table class="aui aui-table-rowhover">
                <thead>
                    <tr>
                        <th>$i18n.getText("ao.admin.plugin.label")</th>
                        <th>$i18n.getText("ao.admin.table.label")</th>
                        <th>$i18n.getText("ao.admin.rows.label")</th>
                        <th><a href="#" title="Delete" class="delete-action">$i18n.getText("ao.admin.action.delete.label")</a></th>
                    </tr>
                </thead>
                <tbody>
                    #foreach($plugin in $tables.keySet())
                    <tr class="ao-plugin">
                        <td class="ao-plugin-description">
                            #if ($plugin.available)
                            <span class="ao-plugin-name">$plugin.pluginName</span>
                            <dl class="ao-plugin-info">
    
                                <dt>$i18n.getText("ao.admin.plugin.key.label")</dt>
                                <dd>$plugin.pluginKey</dd>
    
                                <dt>$i18n.getText("ao.admin.plugin.vendor.label")</dt>
                                <dd>
                                    #if ($plugin.vendorName && $plugin.vendorUrl)
                                        <a href="$plugin.vendorUrl">$!plugin.vendorName</a>
                                    #else
                                        $!plugin.vendorName
                                    #end
                                </dd>
    
                                <dt>$i18n.getText("ao.admin.plugin.version.label")</dt>
                                <dd>$plugin.pluginVersion</dd>
                            </dl>
                            #else
                                <span class="ao-plugin-unknown">$i18n.getText("ao.admin.plugin.unknown")</span>
                            #end
                        </td>
                        <td class="ao-table-names">
                            <ul>
                                #foreach($i in $tables.get($plugin))
                                    <li>$i.table</li>
                                #end
                            </ul>
                        </td>
                        <td class="ao-row-counts">
                            <ul>
                                #foreach($i in $tables.get($plugin))
                                <li>$i.rows</li>
                                #end
                            </ul>
                        </td>
                        <td class="ao-actions">
                            <ul>
                                #foreach($i in $tables.get($plugin))
                                        <li><input type="checkbox" name="tableNames" value="$i.table" id="checkbox-delete-$i.table" /></li>
                                #end
                            </ul>
                        </td>
                    </tr>
                    #end
                </tbody>
            </table>
            
            <input type="hidden" name="atl_token" value="${atl_token}" />
        </form>
        
        <!-- Internationalisation -->
        <input type="hidden" id="i18nAoAdminDeleteConfirmTitle" value="$i18n.getText("ao.admin.delete.confirm.title")" />
        <input type="hidden" id="i18nAoAdminDeleteConfirmMessage" value="$i18n.getText("ao.admin.delete.confirm.message", "{0}")" />
        
        <input type="hidden" id="i18nAoAdminDeleteNoTableSelectedTitle" value="$i18n.getText("ao.admin.delete.no.table.selected.title")" />
        <input type="hidden" id="i18nAoAdminDeleteNoTableSelectedMessage" value="$i18n.getText("ao.admin.delete.no.table.selected.message")" />
        
        <input type="hidden" id="i18nAoAdminDeleteButtonClose" value="$i18n.getText("ao.admin.delete.button.close")" />
        <input type="hidden" id="i18nAoAdminDeleteButtonConfirm" value="$i18n.getText("ao.admin.delete.button.confirm")" />
        
    </body>
</html>
